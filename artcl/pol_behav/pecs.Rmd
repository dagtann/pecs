---
output:
    pdf_document:
        includes:
            in_header: header.tex
    documentclass: article
---

```{r, optionsChunk, include = FALSE}
knitr::opts_chunk$set(
    cache = FALSE, eval = TRUE, echo = FALSE, fig.align = "center",
    fig.width = 12, fig.height = 8, warning = FALSE, message = FALSE,
    fig.lp="fig:", fig.pos="t"
)
source("~/github/pecs/src/r/initialize_workspace.R")
```

\maketitle

\section{Introduction}

Why do citizen turn out to vote? Starting from formal treatments of the matter
this question has branched out into
a theoretically and empirically rich debate over the past decades.
Contributions range from voters' personal evaluations of electoral dynamics, to
elite mobilization efforts and the role of political institutions, especially
the electoral system \cite{Blais.2006}. The latter branch of the debate
is characterized by a persistent conundrum. Proportionality
of electoral systems is widely held to increase turnout for a variety of
reasons \cite[194f.]{Smith.2018}. Yet, the empirical support for this proposition
is inconclusive \cite[705]{Stockemer.2017}. One possible explanation turns on the
trade-off between is the number of parties and government identifiability in
proportional systems. On the one hand, proportional systems tend to generate
larger numbers of political parties and thereby increase voters' chances to
find a party they identify with and vote for. On the other hand, higher numbers
of political parties limit the identifiability of post-election governments,
reducing the say voters' in government selection and thus their incentive to
turn out and vote.

Addressing this trade-off between the electoral and the party system, recent
research has set eyes on pre-electoral coalitions (PECs)
\cite{Golder.2006,Tillman.2015} [ELLGER 2017]. These "collection[s] of parties
that do not compete independently in an election either because they publicly
agree to coordinate their campaigns, run joint candidates or joint lists, or
govern together following the election" \cite[11]{Golder.2005} help voters to
identify future governments. Consequently, PECs increase transparency under
proportional representation and motivate citizens' to go to vote.
\cite{Tillman.2015} presents the hitherto strictest test of this proposition.
He studies $19$ parliamentary democracies between $1970$ and $2002$ and concludes
that the presence of a PEC increases turnout on average by more than 1.5
percentage points. Tillman's efforts find honorable mention in a recent review
of the field, stating that "pre-electoral coalitions help to mitigate the
downward effect of multipartism on turnout" \cite[197]{Smith.2018}. In this
paper find reason to disagree with the broad endorsement of PECs as a means to
increase turnout and grasp the opportunity to explore a rephrased version of the
question: What, if any, pre-electoral coalitions turn out the vote?

The second section of this paper is motivated by previous, critical
reassessments of \cite{Tillman.2015} (e.g., [ELLGER 2017]) and replicates the
original analysis. It diagnoses a severe form of model misspecification.
Using a variety of graphical and statistical tests we provide clear evidence
that Tillman's key conclusion is entirely driven by shared a trend in
turnout and the chance of PECs entering national elections. At the same time,
our replication in Section 2 finds a robust association between the
total vote share going to PECs and turnout.

This association lies at the center of the third section because it strikes us
as theoretically shallow. If pre-electoral coalitions signal viable
post-election governments to voters, then it stands to reason that both
turnout and total PEC vote relate to the strength of this signal. Following
this theoretical hunch, we shift gears and explore the impact of PEC
properties such as their type, incumbent status, and the existence of a joint
program on turnout. This purely exploratory exercise is based on the premise
the signal voters' receive from pre-electoral coaltions becomes the more
powerful the more committed parties are. Consequently, our exploratory analysis
gauges the possibility that PEC properties reflect varying degrees of
commitment and confound the association between turnout and total PEC vote.

The paper concludes with a washing list of future opportunities for empirical
research because the data strictly reject our theoretical intuition: No PEC of
any type turns out the vote and PEC properties do not constitute a common cause
of the association with turnout and PEC vote share.


\section{Replication}

\cite{Tillman.2015} relies on a standard fixed-effects panel design in order to
study the effect of pre-electoral coalitions on turnout in 243 parliamentary
elections between 1970 and 2011. In the causal craze of this day and age
fixed-effects designs have become the "gold standard" \cite[139]{Bell.2015} in
many fields because they eliminate heterogeneity bias. More precisely, by way of
simple transformations of the data fixed-effects designs remove time-invariant
unit-specific unobservables \cite[508]{Halaby.2004}. In Tillman's case that
refers to permanent ideosyncracies of the twenty parliamentary democracies in
his data. Having eliminated unobserved heterogeneity among the units,
fixed-effect designs return unbiased estimators of a hypothesized causal effect
as long as the disturbances are mean-independent of the independent variable(s)
across \textit{all} measurement occasions \cite[482]{Wooldridge.2009}. Despite
their appeal for causal inference, however, fixed-effects designs have recently
come under attack for various reasons [add references]. A most recent
Monte-Carlo study even advises advise scholars to distrust fixed-effects
estimators whenever there is a reason to suspect "the presence of any dynamic
misspecification or omitted time-varying variables"
\cite[26; our emphasis]{Pluemper.2019}. Evidence of such misspecification in
Tillman's analysis will be presented in the following.

Misspecifications of fixed-effects designs arise in numerous ways of which
failure to account for non-stationarity is particularly troublesome.\footnote{
    This paragraph summarizes what I understand so far. I am pretty sure,
    there is room for improvement. Hints to easy-going literature on time
    series and panel data analysis are very welcome.
}
Stationarity requires that the mean, variance, and autocorrelation of a
time-series are finite and constant over time \cite[378]{Wooldridge.2001}. Its
violations take the form of either mean shifts or trends. While we have little
reason to suspect the former in Tillman's data, we do find evidence for the
latter, leading us to argue that Tillman's results suffer from the so-called
"spurious" or "nonsense regression problem" \cite{Granger.1974,Wooldridge.2009}.
To elaborate, if trends mar the data, then otherwise independent variables may
still seem strongly related. The reasons are twofold. First, trends go hand in
hand with serial or autocorrelation among the errors. Observations close in time
tend to be more similar than others \cite[432]{Fox.2008}. As a consequence, the
usual test statistics and any tests of hypothesis based on them are invalid.
Second, the estimated effect itself may be biased because the trend -- more
precisely, its (unobserved) causes -- confounds the relationship between two
variables. In other words, two trending variables may seem related because they
share a time-varying, common cause. Progressing from simple visual inspection to
standard diagnostics and detrending tools, we demonstrate below that a common
trend in turnout and the formation of pre-electoral coalitions biases
much, but possibly not not all of Tillman's results.

```{r, edaNonStationarity, fig.cap="Visual Assessment of Stationarity"}
rm(list = ls()[!(ls() %in% clean_workspace)])
pdta <- filter(country_panel, in_tillman == 1) %>%
    select(iso3c, year, turnout, pec1, vote_pec) %>%
    mutate(turnout = turnout / 100, vote_pec = vote_pec / 100)
tmp <- aggregate(
    pdta[, c("turnout", "pec1", "vote_pec")],
    list(year = pdta[["year"]]),
    FUN = mean, na.rm = TRUE
)
tmp[, "statistic"] <- "mu"
tmp2 <- aggregate(
    pdta[, c("turnout", "pec1", "vote_pec")],
    list(year = pdta[["year"]]),
    FUN = sd, na.rm = TRUE
)
tmp2[, "statistic"] <- "sigma"
pdta <- bind_rows(tmp, tmp2) %>%
    gather("key", "value", turnout, pec1, vote_pec) %>%
    mutate(
        key_labels = factor(
            key, levels = c("turnout", "pec1", "vote_pec"),
            labels = c("Turnout", "PEC contested", "Vote PEC")
        ),
        statistic_labels = factor(statistic, levels = c("mu", "sigma"),
                labels = c("Mean", "Std. Dev.")
            )
    )
ggplot(data = pdta, aes(x = year, y = value)) +
    geom_point(shape = 21, fill = "white") +
    geom_smooth(method = "lm", se = FALSE, formula = y ~ poly(x, 3), colour = "black", size = .7) +
    facet_grid(statistic_labels ~ key_labels) +
    labs(caption = "Note: Features rescaled to unit-ranges. Cubic polynomials added."
    ) +
    ggthemes::theme_fivethirtyeight()
```

The properties of stationary data imply graphical tests, the simplest of
which are scatterplots of means and variances against time. If the data on
turnout and pre-electoral coalitions are stationary, then their mean and
variance should fluctuate only randomly over time. Figure
\ref{fig:edaNonStationarity}, however, implies the opposite. It plots annual
means (top row) and standard deviations (bottom row) for each of Tillman's
pivotal variables.\footnote{
    The publication features a number of indicator variables which discretize
    the electoral strength of pre-electoral coalitions. For example, one binary
    indicator takes the value of 1 whenever at least one pre-electoral
    coalition received at least 20 percent of the national vote
    \cite[731]{Tillman.2015}. As these binary indicators are functions of the
    overall electoral strength of pre-electoral coalitions, they will
    follow the same trend, if any.
}
Cubic polynomials have been added to each plot and highlight the development
of their central tendency. All in all, Figure \ref{fig:edaNonStationarity} graph
casts severe doubt on the stationarity of the data.

\begin{enumerate}
    \item As documented by prior research, average turnout has been declining
        for years \cite{Hooghe.2017}. Starting at 88 percent in 1970, the
        annual mean in the top-left panel reaches an all-time low at 66 percent
        in 2000 and shows no sign of reversion until the end of
        the observation period. Pre-electoral coalitions exhibit a more
        complex, though not unrelated trend. As shown in the middling
        panel of the top row, PECs become more prevalent in national elections
        until the mid-1980s. Later on, their attraction nosedives -- in parallel
        to turnout. Voting results for PECs, in contrasts, do not exhibit such
        clear-cut patterns.
    \item Turning to their second moment, evidence against stationarity of the
        data is not as obvious. On the one hand, the standard deviation
        about the annual average in turnout has monotonically increased over
        time. This observation clearly speaks to non-stationarity. On the other
        hand, the variances in the formation and showing of pre-electoral
        coalitions are prone to some notable outliers that may skew the overall
        impression from the diagram.
    \item Finally, Figure \ref{fig:edaCommonTrend} in the Appendix
        disaggregates the data to the country-level. As can be seen from the
        individual panels, all three indicators, turnout, the formation of
        pre-electoral coalitions, and their voting result, seem to change
        systematically over time. However, there are stark differences between
        countries which occasionally exhibit very complex trends.
\end{enumerate}

As noted repeatedly above, visual assessments of statistical phenomena are
informative but often subjective. Hence, they should be accompanied by more
formal evidence whenever possible. In the case of non-stationarity, tests for
autocorrelation among the residuals constitute one option. Table
\ref{tbl:TestsSerialCorrelation} reports several different autocorrelation
diagnostics.\footnote{
    Additional unit root tests would be awesome, but package plm fails to
    compute. Advise is welcome.
}
All of them all evaluate Tillman's pivotal regression models \cite[733, Table 4;
Models 2 and 4]{Tillman.2015}. The Durbin–Watson statistic detects first-order
autocorrelation among the residuals. Its classical form does not account for
panel-data and has thus been generalized by \cite{Baltagi.1999}. If first-order
autocorrelation (AR(1)) was not an issue, than either variant of the statistic
should approach 2. This is clearly not the case. Rather, at values about 1
either variant of the Durbin-Watson statistic implies positive autocorrelation
among the residuals. In contrast to other tests for autocorrelation, the
Breusch–Godfrey test allows the user to choose the order of autocorrelation to
test for. The table shows evidence in favor of AR(1) and AR(2) processes. At 1
respectively 2 degrees of freedom all 4 $\chi^2$-statistics reach very highly
levels of statistical significance and reject the null of no-autocorrelation.
Finally, \cite[Sec. 10.5.4]{Wooldridge.2010} proposes a test for serial
correlation among the errors in fixed–effects panel models. Table
\ref{tbl:TestsSerialCorrelation} reports the corresponding F-scores and degrees
of freedom. Either test is highly statistically significant and rejects the null
of no-serial correlation. In conclusion, the table supports our earlier
impression of non-stationary in the data and sheds further doubt on Tillman's
results.


```{r, reportSerialCorrelation, eval = FALSE}
data_to_fit <- filter(
    country_panel, in_tillman == 1 & !(iso3c %in% c("LUX", "CAN"))
)
data_to_fit <- pdata.frame(data_to_fit, index = c("iso3c", "year2"))
fit_contested <- plm(
    turnout ~ pec1 + enep + disprop * pr + plurality * closeness + growth +
    lnincome, model = "within", data = data_to_fit
)
fit_result <- plm(
    turnout ~ vote_pec + enep + disprop * pr + plurality * closeness + growth +
    lnincome, model = "within", data = data_to_fit
)
vapply(list("contested" = fit_contested, "result" = fit_result), function(x) {
    pdw <- pdwtest(x)[["statistic"]]
    pbn <- pbnftest(x)[["statistic"]]
    pbg1 <- pbgtest(x, order = 1)[["statistic"]]
    pbg1_p <- pbgtest(x, order = 1)[["p.value"]]
    pbg2 <- pbgtest(x, order = 2)[["statistic"]]
    pbg2_p <- pbgtest(x, order = 2)[["p.value"]]
    out <- c(pdw, pbn, pbg1, pbg1_p, pbg2, pbg2_p)
    return(out)
},
    FUN.VALUE = numeric(6)
)
pwartest(fit_contested)
pwartest(fit_result)

pbgtest(fit_contested, order = 2)
```

\begin{table}
    \centering
    \begin{tabular}{lcc}
        \toprule
        ~ & \multicolumn{2}{c}{Test Statistic} \\
            & PEC contested & PEC result \\
        \midrule
        Classical Durbin–Watson & 1.2 & 1.2 \\
        Modified Durbin–Watson & 0.9 & 0.9 \\
        Breusch-Godfrey $\chi^2_{AR(1)}$ & 48.1 & 44.7 \\
        Breusch-Godfrey $\chi^2_{AR(2)}$ & 48.2 & 44.8 \\
        Wooldridge & $F_{(1, 220)} = 18.31$ & $F_{(1, 216)} = 17.96$ \\
        \bottomrule
    \end{tabular}
    \caption{Tests for Serial Correlation among the Residuals}
    \label{tbl:TestsSerialCorrelation}
\end{table}


How to deal with non-stationarity in fixed-effects designs? One solution
explicitly includes a trend component into the analysis. There are several
options to do so. Firstly, a two-way error components model eliminates
unobserved heterogeneity among the units \text{and} the time points
\cite[982]{Bruederl.2010}. It is akin to a unit-fixed-effects model that
includes also time dummies and constitutes a conventional choice in panel data
analysis. Secondly, a time index component can be included as an independent
variable. The index variable reduces confounding due to trends in the data. A
somewhat more flexible version of this approach interacts the time index with
the unit-fixed effects to estimate unit-specific trends (growth curves).
A third solution to the problem of non-stationarity transforms the data,
e.g., by taking first-differences or applying a Prais-Winston
transformation\footnote{
    We did not get around to implement the Prais-Winston regression yet.
}.
Finally, dynamic-panel models have been suggested as a fix for serial
correlation among the errors [REFERENCE]. The perhaps best known variant of
this approach goes back to \cite{Beck.1995}. It adds a one-period lag of
the dependent variable to the predictors and uses panel-corrected standard
errors. Each of these attempted solutions approaches non-stationarity from a
different angle, and, taken together, they add up to a rigorous reassessment of
the relationship between pre-electoral coalitions and turnout in parliamentary
democracies.

We present results for each of the previously described variations\footnote{
    Again, we didn't get around to do Prais-Winston, yet.
}
on the fixed-effects scheme in Figure \ref{fig:reportDetrendedResults}. The top
row plots the marginal effect of PEC formation on turnout, while the bottom
row shows the marginal effect of the total PEC vote share on turnout.\footnote{
    Following the original publication, turnout and Vote PEC are measured in
    percent.
}
Confidence intervals at the 90 and 95 percent levels have been added to each
panel.\footnote{
    All models use panel-corrected standard errors, clustered by country.
}

```{r, reportDetrendedResults, fig.cap="Estimated Effect of PECs on Turnout", fig.pos = "hb"}
# Initialize
rm(list = ls()[!(ls() %in% clean_workspace)])
packages <- c("plm", "sandwich", "lmtest", "texreg")
for(i in packages){
    if(!(i %in% rownames(installed.packages()))) {
        cat("Now installing required package:\t", i)
        install.packages(i, dependencies = TRUE)
    }
    library(i, character.only = TRUE)
}


# Declare Functions
extract_results <- function (model, of.interest = NULL, pcse = "group") {
    out <- cbind(beta = coef(model), se = sqrt(diag(vcov(model))))
    if(!is.null(pcse)) {
        out[, "se"] <- sqrt(diag(plm::vcovBK(model, cluster = pcse)))
    }
    if (!is.null(of.interest)) {
        out <- out[grep(of.interest, rownames(out), perl=TRUE), ]
    }
    return(out)
}


# Declare string constants
panel_id <- c("country", "year2")
control <- paste(
    c("enep", "disprop * pr", "plurality * closeness", "growth", "lnincome"),
    collapse = " + "
)
treatments <- c("PEC contested" = "pec1", "Vote PEC" = "vote_pec")
response <- "turnout"
trends <- c("None"="None", "Two-way Error\nComponent"="twoways",
    "Common\nTrend"="t", "Unit-specific\nTrend"="t*iso3c",
    "First\nDifference"="fd", "Lagged DV"="turnout_l1"
)


# Prepare data
data_to_fit <- filter(country_panel, (in_tillman == 1) &
    !(iso3c %in% c("LUX", "CAN"))
) %>%
    group_by(iso3c) %>%
    mutate(turnout_l1 = dplyr::lag(turnout, n = 1, order_by = year2)) %>%
    ungroup()
data_to_fit <- pdata.frame(data_to_fit, index = c("iso3c", "year2"))


# Fit models
fitted_models <- list()
for (trend in trends){
    for(treatment in treatments) {
        assign(
            "frm",
            paste0(response, " ~ ", paste(treatment, control, trend, sep=" + "))
        )
        if (trend == "None") {
            assign(
                "frm",
                paste0(response, " ~ ", paste(treatment, control, sep=" + "))
            )
        }
        if (trend == c("twoways")) {
            assign(
                "frm",
                paste0(response, " ~ ", paste(treatment, control, sep=" + "))
            )
            fitted_models[[paste(trend, treatment, sep = "_")]] <- plm(
                as.formula(frm), effect="twoways", model="within", data=data_to_fit
            )
            next
        }
        if (trend == c("fd")) {
            assign(
                "frm",
                paste0(response, " ~ ", paste(treatment, control, sep = " + "))
            )
            fitted_models[[paste(trend, treatment, sep = "_")]] <- plm(
                as.formula(frm), effect="individual", model="fd", data=data_to_fit
            )
            next
        }
        fitted_models[[paste(trend, treatment, sep = "_")]] <- plm(
            as.formula(frm), model = "within", data = data_to_fit
        )
    }
}


# Generate coefficient plot
to_plot <- vapply(fitted_models[c(1:8, 11:12)],
    FUN=extract_results, FUN.VALUE=numeric(2), of.interest="pec"
)
to_plot <- cbind(
    to_plot, vapply(fitted_models[c("fd_pec1", "fd_vote_pec")],
    FUN = function(model){
        out <- cbind(beta = coef(model), se = sqrt(diag(vcov(model))))
        out <- out[grep("pec", rownames(out), perl=TRUE), ]
        return(out)
    },
    FUN.VALUE = numeric(2)
    )
)
to_plot <- t(to_plot)
treatment_locations <- str_locate(rownames(to_plot), "vote_pec$|pec1$")
treatment_labels <- str_sub(rownames(to_plot), treatment_locations)
treatment_labels <- factor(treatment_labels, treatments, names(treatments))
trend_labels <- str_split_fixed(rownames(to_plot), "vote_pec|pec1", 2)[, 1]
trend_labels <- str_sub(trend_labels, 1, str_locate(trend_labels, "_$")[, 1]-1)
trend_labels <- factor(trend_labels, trends, names(trends))
z <- qnorm(c(.1, .05) / 2, lower = FALSE)
pdta <- tibble(beta=to_plot[, "beta"], se=to_plot[, "se"],
    trend_label=trend_labels, treatment_label=treatment_labels
) %>%
    mutate(lower90 = beta - z[1] * se, upper90 = beta + z[1] * se) %>%
    mutate(lower95 = beta - z[2] * se, upper95 = beta + z[2] * se)
ggplot(data = pdta, aes(x = trend_label, y = beta)) +
    geom_linerange(aes(ymin = lower95, ymax = upper95)) +
    geom_linerange(aes(ymin = lower90, ymax = upper90), size=1.1) +
    geom_point(size = 2, shape = 21, fill = "white") +
    labs(x = "Correction for Non-Stationarity", y = "Effect Estimate",
        caption = "Note: CIs at 90 and 95 percent."
    ) +
    facet_grid(treatment_label ~ ., scales = "free") +
    ggthemes::theme_fivethirtyeight() +
    theme(axis.title = element_text())


# Return BTON
ar_statistics <- vapply(fitted_models,
    function(m) {
        pdw <- pdwtest(m)[["statistic"]]
        pbg1 <- pbgtest(m, order = 1)[["statistic"]]
        pbg2 <- pbgtest(m, order = 2)[["statistic"]]
        c(pdw, pbg1, pbg2)
    },
    FUN.VALUE = numeric(3)
)
ses <- lapply(fitted_models[c(1:8, 11:12)], vcovBK, cluster = "group")
ses[["fd_pec1"]] <- vcov(fitted_models[["fd_pec1"]])
ses[["fd_vote_pec"]] <- vcov(fitted_models[["fd_vote_pec"]])
ses <- ses[names(fitted_models)]
pvals <- lapply(names(fitted_models),
    function(x) coeftest(fitted_models[[x]], vcov = ses[[x]])[, 4]
)
names(pvals) <- names(fitted_models)
texreg(
    fitted_models,
    file = file.path(path_project, "artcl", "detrended_models.tex"),
    digits = 2,
    omit.coef = "(t:)",
    override.se = lapply(ses, function(x){sqrt(diag(x))}),
    override.p = pvals,
    custom.coef.names = c("PEC contested", "Parties", "Disproportionality",
        "PR", "Plurality", "Closeness", "Economic Growth", "log(Income)",
        "Disproportionality $\\times$ PR",  "Plurality $\\times$ Closeness",
        "Vote PEC", "$t$", "Constant", "Turnout$_{t-1}$"
    ),
    reorder.coef = c(1, 11, 2:10, 12, 14, 13),
    booktabs = TRUE, sideways = TRUE,
    stars = c(0.001,  0.01, 0.05, 0.1),
    caption = "Replication Results",
    label = "tbl:ReplicationResults",
    custom.note = paste0("Panel corrected SEs in parantheses ",
        "\\cite{Beck.1995}, clustered by country. %stars."
    )
)
# Manual edits to BTON
tmp <- readLines(file.path(path_project, "artcl", "detrended_models.tex"))
tmp <- tmp[!(tmp == "")]  # drop empty strings
tmp <- tmp[!grepl("\\usepackage", tmp)]  # drop usepackage entries
tmp[grepl("[a-z]\\_[a-z]", tmp)] <- paste(
    "Detrending Technique", "\\multicolumn{2}{c}{None}",
    "\\multicolumn{2}{c}{2way EC}",
    "\\multicolumn{2}{c}{Common Trend}",
    "\\multicolumn{2}{c}{Unit-specific Trend}",
    "\\multicolumn{2}{c}{FD}",
    "\\multicolumn{2}{c}{LDV} \\\\",
    sep = " & "
)  # replace table header
split_at <- which(tmp == "\\bottomrule")
ar_labels <- c("Durbin-Watson",
  "Breusch-Godfrey $\\chi^2_{AR(1)}$", "Breusch-Godfrey $\\chi^2_{AR(2)}$"
)
lines_to_add <- vector("character", length(ar_labels))
for(i in seq(lines_to_add)) {
    lines_to_add[i] <- paste0(
        paste0(ar_labels[i], " & "),
        paste(signif(ar_statistics[i, ], 3), collapse = " & "),
        "\\\\"
    )
}
tmp <- c(tmp[1:(split_at - 1)], lines_to_add, tmp[split_at:length(tmp)])
writeLines(tmp, con = file.path(path_project, "artcl", "pol_behav", "detrended_models.tex"))


# housekeeping
for (p in packages) detach(paste("package", p, sep = ":"), character.only = TRUE)
rm(list = ls()[!(ls() %in% clean_workspace)])
```

The left-most column replicates Tillman's original analysis which does not
account for non-stationarity. It implies that pre-electoral coalitions boost
turnout (top) and that an increase in their share of votes concurs with an
increase in turnout (bottom). All confidence intervals securely exclude $0$,
meeting conventional standards of statistical significance. Things change
markedly once non-stationarity is taken into account. Going from left to right
in the top row, the mobilizing potential of PEC entering elections is (a)
immediately and notably reduced in magnitude, and (b) almost consistently
indistinguishable from $0$. The dynamic panel model constitutes the sole
exception to this rule, but it should not receive too much emphasis. After all,
even this modeling approach matches the more general pattern, it primarily
addresses serial correlation among the errors, and its confidence intervals just
barely exclude $0$.

Results in the bottom row are more mixed. In all but two instances stronger
electoral showings of PECs coincide with higher turnout even after
non-stationarity has been accounted for and even though the magnitude of the
estimated coefficient declines by up to 50 percent. Yet, many estimates still
meet conventional levels of statistical significance. It is noteworthy, though,
that the unit-specific trend and the first-difference formulation render the
electoral strength of PECs statistically indistinguishable from $0$. These
models apply the most stringent fixes of non-stationarity, and they clearly
reduce first order autocorrelation among the among the errors (see
\ref{tbl:ReplicationResults}).

To summarize the replication: Once non-stationarity is taken into account the
mobilizing effect of PEC formation is entirely unsupported. This implication
is remarkably robust against different strategies to account for
non-stationarity. Notwithstanding, data hint to a continued association between
their electoral strength and turnout. This hint will be subject to analysis in
the following, exploratory section.


\section{Exploratory Analysis: What Pre-electoral Coalitions matter?}

The previous section casts doubt on the mobilizing potential of
pre-electoral coalitions, but it does not prove the suspicion entirely unfounded.
Participation in elections does not increase when PECs enter the race, but their
strong showing tends to coincide with higher levels of turnout. Notwithstanding,
this seemingly robust association is theoretically shallow. If PECs provide
information on credible coalition governments and thereby incentivize turnout,
then we should focus on that message itself, not its ultimate effect. After all,
its ultimate effect may be endogenous to any number influences from the macro,
meso or micro level of parliamentary elections. The following section turns to a
number of PEC properties that may drive the seemingly robust association between
turnout and PEC total vote share. It concludes on a skeptical note.

This exploratory endeavor takes advantage of new data on PECs and their
properties compiled by [GANGHOF AND EPPNER]. Following \cite{Golder.2006}, their
data define as pre-electoral coalition any group of parties that publicly and
mutually announces its intention to form or continue a coalition government
prior to election night. Any such statement shrinks the set of government
alternatives and thereby structures post-election coalition bargaining.
Notwithstanding, pre-electoral coalitions differ in their degree of commitment.
Some PECs merely announce their intention to cooperate come election dawn,
whereas others provide voters with detailed voting instructions, formulate joint
programs or field common candidates. Emphasizing those differences, the data
classify PECs by their type, the existence of a joint manifest, and their
incumbency status. For the purpose of this exploratory analysis, we presume that
such differences between pre-electoral coalitions reflect different levels of
sincerity among political parties and, thus, send more powerful messages to
voters.

```{r, ourPecsInTillman, eval=FALSE}
# Return totals for table
rm(list = ls()[!(ls() %in% clean_workspace)])
table_data <- filter(country_panel, (in_tillman == 1))
type_indicators <- grep("any_type[1-9]", names(table_data))
apply(table_data[, c("pec_neu", "any_incumbent", "any_prog")], 2, table)
apply(table_data[, type_indicators], 2, sum)
apply(table_data[table_data[, "any_incumbent"] == 1, type_indicators], 2, sum)
apply(table_data[table_data[, "any_prog"] == 1, type_indicators], 2, sum)
rm(list = ls()[!(ls() %in% clean_workspace)])
```

\begin{table}[ht]
    \centering
    \begin{tabular}{rccccccc}
        \toprule
        \multicolumn{2}{c}{} & \multicolumn{6}{c}{By Type} \\
        \cmidrule{3-8}
        ~ & Total & Public & Joint & Nomination & Dual-Ballot & Vote Transfer\\
        \multicolumn{1}{l}{Any PEC} & Elections & Commitment & List & Agreement & Instructions & Instructions & Other\\
        \midrule
        observed?           & 157 & 63 & 36 & 46 & 0 & 11 & 9\\
        incumbent?          &  46 & 31 & 21 &  3 & 0 &  6 & 1\\
        joint program?      &  64 & 32 & 14 & 32 & 0 &  1 & 3\\
        \bottomrule
        \multicolumn{8}{l}{
              \textit{Reading example}: The incumbent government formed a pre-electoral coalition in $46$ elections.
        } \\
        \multicolumn{8}{l}{
              Those coincided with $31$ elections during which at least one PEC was publicly announced.
        } \\
        \multicolumn{8}{l}{
              Elections may be double-counted.
        }
    \end{tabular}
    \caption{Absolute Frequency of PECs in 243 National Elections}
    \label{tbl:AbsFreqPecsInElections}
\end{table}

Table \ref{tbl:AbsFreqPecsInElections} summarizes our account of pre-electoral
coalitions for Tillman's 243 elections in 20 parliamentary democracies between
1970 and 2011.\footnote{
    Ganghof's and Eppner's data cover 563 elections in 35 democracies between
    1945 and 2015. In order to keep our results comparable
    with prior research, we limit ourselves to the set of parliamentary
    elections studied by Tillman. Tables \ref{tbl:summaryPecs} and
    \ref{tbl:SummaryPecProperties} in the Appendix summarize all the
    available data. Note, however, that there are occasionally non-trivial
    differences between our data and what Tillman's data counts as PEC. For
    instance, our data regards the decades-long cooperation between the German
    CDU and CSU as a pre-electoral whereas Tillman's data does not. As will
    become clear shortly, those difference do not interfere with the results.
}
According to our data, pre-electoral coalitions formed in 157, i.e. more than
half of all 243 elections. The incumbent government formed a PEC in roughly 1
out of 5 elections, and participants of at least one PEC agreed on a joint
program in approximately 25 percent of all elections. Mind the level of
aggregation: Following Tillman's example, these figures reflect the election-year
level. Therefore, categories are not mutually exclusive and pre-electoral
coalitions may be double counted.\footnote{
    For instance, in 1983 the \textit{incumbent} German government, CDU/CSU and
    FDP,  \textit{publicly announced} their intention to continue their
    coalition after the election. At the same time, CDU and CSU maintained
    a separate, non-incumbent, but \textit{nomination agreement}.
}
Regardless, public announcements of coalition intent are the modal form
of PEC across all elections. Joint lists and nomination agreements among
political parties come in second. When taken together, these categories may even
outweigh public announcements. By comparison, vote transfer and dual-ballot
instructions or other highly individual forms of pre-electoral agreements are
rare. These figures may be read as a hint stronger commitment among political
parties who agree on nominations, present joint lists or present joint programs
because these cooperation forms entail additional transactions costs for them.

Does their investment yield any return on turnout? Figure
\ref{fig:boxplotTurnoutAndOurPecsInTillman} explores this question from several
angles. Each boxplot in this graph summarizes the distribution of
residual within-differences in turnout after heterogeneity by country and year
has been accounted for. Consequently, the figure shows the variation that
two-ways fixed effects models ultimately evaluate (see \cite{Mummolo.2018}).
For each type of PEC entering national elections the figure shows three things:
(1) their marginal contribution to turnout, (2) their contribution to turnout
given that one PEC was the incumbent government, and (3) their contribution to
turnout given that at least one PEC presented voters with a joint
program.\footnote{
    They reader may infer the latters' the marginal associations with turnout
    from the positions of the medians across each row.
}
If PECs matter for turnout then the boxplots -- the medians in particular --
will change their position depending on the stated combination of PEC
properties. Alas, the more conditions change, the more turnout stays the same.

```{r, boxplotTurnoutAndOurPecsInTillman, fig.cap="Turnout by PEC Properties"}
rm(list = ls()[!(ls() %in% clean_workspace)])
# data objects
type_lookup <- c("No PEC" = 0, "Nomination agreement" = 1, "Joint list" = 2,
    "Dual-ballot Instructions" = 3, "Vote transfer Instructions" = 4,
    "Public commitment" = 5, "Other" = 6
)
pdta <- filter(country_panel, in_tillman == 1)
pdta[, "turnout_2way"] <- resid(
    lm(turnout ~ factor(iso3c) + factor(year2), data = pdta)
)
pdta <- pdta %>%
    mutate(any_type0 = pec_neu == 0) %>%
    select(c("election_id", "turnout_2way", paste0("any_type", 0:6), "any_prog", "any_incumbent")) %>%
    gather("key", "value", turnout_2way) %>%
    select(-key) %>%
    rename(turnout_2way = value) %>%
    gather("any_type", "value", any_type0:any_type6) %>%
    mutate(any_type_label = NA)
for (i in seq(type_lookup)) { # store full type label for each i in type_lookup
    mask <- which(
        pdta[["any_type"]] == paste0("any_type", type_lookup[i]) &
        pdta[["value"]] == 1
    )
    pdta[mask, "any_type_label"] <- names(type_lookup)[i]
}
pdta <- na.omit(pdta)  # Drop NA entries in any_type_label -> gather() artifacts
# Create data frame for each row in the final plot.
pdta_incumb <- rename(pdta, status = any_incumbent) %>%
    mutate(key_label = "Any incumbent?") %>%
    select(-any_prog)
pdta_prog <- rename(pdta, status = any_prog) %>%
    mutate(key_label = "Any joint program?") %>%
    select(-any_incumbent)
pdta <- mutate(pdta, status = 0, key_label = "Marginal") %>%
    select(-any_prog, -any_incumbent)
pdta <- rbind.data.frame(pdta, pdta_incumb, pdta_prog)  # Stack DFs for plot.
pdta <- mutate(pdta,  # Prettify plot labels
    any_type_label = factor(any_type_label, levels = c(
        "Public commitment", "Nomination agreement", "Joint list",
        "Dual-ballot Instructions", "Vote transfer Instructions", "Other",
        "No PEC"),
        labels = c("Public\nCommitment", "Nomination\nAgreement", "Joint\nList",
            "Dual-ballot\nInstructions", "Vote Transfer\nInstructions",
            "Other", "No PEC")
    ),
    key_label = factor(as.character(key_label),
        levels = c("Marginal", "Any incumbent?", "Any joint program?")),
    status_label = factor(status, levels = 0:1, labels = c("No", "Yes"))
)
ggplot(data = pdta, aes(x = any_type_label, y = turnout_2way,
    fill = status_label)
) +
    geom_boxplot(outlier.fill = "white", outlier.shape = 21) +
    scale_x_discrete(drop=FALSE) +
    scale_fill_brewer(type = "seq", palette = 6) +
    labs(x = "Type of PEC", y = "Residual Within-Differences in Turnout\nafter Two-way Fixed-Effects Adjustment") +
    facet_grid(key_label ~ .) +
    ggthemes::theme_fivethirtyeight() +
    theme(
        axis.title = element_text(),
        legend.title = element_blank()
    )
# housekeeping
rm(list = ls()[!ls() %in% clean_workspace])
```

\begin{enumerate}
    \item The top row in Figure \ref{fig:boxplotTurnoutAndOurPecsInTillman}
        shows the marginal covariation between turnout and type of PEC. The
        number of observations covered by each boxplot is reported in the top
        row of Table \ref{tbl:AbsFreqPecsInElections}. With the sole exception
        of vote transfer instructions, a category which is based on only $11$
        elections, turnout does not visibly respond to the formation
        pre-electoral coalitions of a given type.
    \item The middling row in Figure \ref{fig:boxplotTurnoutAndOurPecsInTillman}
        conveys two pieces of information. On the one hand, there is scant
        evidence to support any interference of government PECs with the
        mobilizing potential of other pre-electoral coalition types. Although
        the boxplots towards the left of the graph shift upwards, and in the
        case of joint lists notably so, the individual distributions still
        overlap to a large extent. To elaborate, even in the case of any PEC
        presenting voters with a joint list, the overlap between residual
        distributions in turnout is still 25 percent, and it includes the
        median of the no-incumbent-PEC condition. Clear separation manifests
        only in cases with very low empirical support. On the other hand, there
        is no discernible marginal influence of pre-electoral coalitions by the
        incumbent government on turnout. This version of the story would
        require that all corresponding boxplots shift in the same direction by
        about the same amount. Nothing of this sort is happening in Figure
        \ref{fig:boxplotTurnoutAndOurPecsInTillman}.
    \item The bottom row repeats the exercise for elections during which at
        least one pre-electoral coalition has formulated a joint program.
        The panel sends two important messages. First, the fact that one
        PEC agrees on a common platform does not seem to condition the
        mobilizing potential of any pre-electoral coalition type. Unless based
        on a small or very small number of observations, all conditional
        distributions overlap and all medians stay close to each other. Second,
        the fact that one PEC presents a joint program does not get out the
        vote either. Otherwise, all boxplots in the joint-program-condition
        should move in the same direction by about the same amount. That is
        clearly not the case.
\end{enumerate}

Disappointing as these implications may be, it still pays to subject the data
to more rigorous scrutiny. Since any number of omitted variables may confound
the mobilizing effect of PECs, exploratory data analysis is only partially
revealing. We therefore return to Tillman's seminal contribution in the
following and use his model as a baseline for continued study. More precisely,
the following paragraphs revisit the matter of turnout and pre-electoral
coalitions using two-way fixed effects models, which (1) evaluate the same set
of elections as Tillman and (2) include his set of control variables but (3)
use our information on pre-electoral coalitions.

Our exploratory analysis proceeds in four steps. The first step replicates the
motivating conclusion from above, according to which higher total vote share
for PECs coincides with higher turnout. This step checks the comparability of
our data and results. Next, information on PEC type, incumbent status, and the
existence of at least one joint program enters the model in a stepwise fashion.
This step gauges the marginal effects of our PEC data on turnout. Third, the
interaction terms explored in Figure
\ref{fig:boxplotTurnoutAndOurPecsInTillman} are added one at a time. This step
broadens our understanding of conditional relationships in the data. Finally,
each of the models above is computed twice: once with and once without the
total PEC vote share entering the model. This last step follows up on our hunch
that PECs differ by the commitment participating parties are ready to make, and
those differences, in turn, are one potential common cause of turnout and PEC
vote share.

```{r, exploratoryResults, fig.cap="Key Results of the Exploratory Analysis"}
rm(list = ls()[!(ls() %in% clean_workspace)])
packages <- c("plm", "sandwich", "lmtest", "texreg")
for(i in packages){
    if(!(i %in% rownames(installed.packages()))) {
        cat("Now installing required package:\t", i)
        install.packages(i, dependencies = TRUE)
    }
    library(i, character.only = TRUE)
}

data_to_fit <- filter(country_panel, (in_tillman == 1)) %>%
    mutate(pectotal_neu = pectotal_neu * 100)
data_to_fit <- pdata.frame(data_to_fit, index = c("iso3c", "year2"))

fitted_models <- list()
fitted_models[["baseline"]] <- plm(
    turnout ~ pectotal_neu + enep + disprop * pr + plurality * closeness +
        growth + lnincome,
    data = data_to_fit, effect = "twoways", model = "within"
)
fitted_models[["type"]] <- plm(
    turnout ~
        any_type1 + any_type2 + any_type3 + any_type4 + any_type5 + any_type6 +
        enep + disprop * pr + plurality * closeness + growth + lnincome,
    data = data_to_fit, effect = "twoways", model = "within"
)
fitted_models[["type_vote"]] <- plm(
    turnout ~
        pectotal_neu +
        any_type1 + any_type2 + any_type3 + any_type4 + any_type5 + any_type6 +
        enep + disprop * pr + plurality * closeness + growth + lnincome,
    data = data_to_fit, effect = "twoways", model = "within"
)
fitted_models[["incumbent"]] <- plm(
    turnout ~
        any_incumbent +
        enep + disprop * pr + plurality * closeness + growth + lnincome,
    data = data_to_fit, effect = "twoways", model = "within"
)
fitted_models[["incumbent_vote"]] <- plm(
    turnout ~
        pectotal_neu + any_incumbent +
        enep + disprop * pr + plurality * closeness + growth + lnincome,
    data = data_to_fit, effect = "twoways", model = "within"
)
fitted_models[["incumbentXtype"]] <- plm(
    turnout ~
        any_incumbent*any_type1 + any_incumbent*any_type2 +
        any_incumbent*any_type3 + any_incumbent*any_type4 +
        any_incumbent*any_type5 + any_incumbent*any_type6 +
        enep + disprop * pr + plurality * closeness + growth + lnincome,
    data = data_to_fit, effect = "twoways", model = "within"
)
fitted_models[["incumbentXtype_vote"]] <- plm(
    turnout ~ pectotal_neu +
        any_incumbent*any_type1 + any_incumbent*any_type2 +
        any_incumbent*any_type3 + any_incumbent*any_type4 +
        any_incumbent*any_type5 + any_incumbent*any_type6 +
        enep + disprop * pr + plurality * closeness + growth + lnincome,
    data = data_to_fit, effect = "twoways", model = "within"
)
fitted_models[["prog"]] <- plm(
    turnout ~
        any_prog +
        enep + disprop * pr + plurality * closeness + growth + lnincome,
    data = data_to_fit, effect = "twoways", model = "within"
)
fitted_models[["prog_vote"]] <- plm(
    turnout ~
        pectotal_neu + any_prog +
        enep + disprop * pr + plurality * closeness + growth + lnincome,
    data = data_to_fit, effect = "twoways", model = "within"
)
fitted_models[["progXtype"]] <- plm(
    turnout ~
        any_prog*any_type1 + any_prog*any_type2 +
        any_prog*any_type3 + any_prog*any_type4 +
        any_prog*any_type5 + any_prog*any_type6 +
        enep + disprop * pr + plurality * closeness + growth + lnincome,
    data = data_to_fit, effect = "twoways", model = "within"
)
fitted_models[["progXtype_vote"]] <- plm(
    turnout ~
        pectotal_neu +
        any_prog*any_type1 + any_prog*any_type2 +
        any_prog*any_type3 + any_prog*any_type4 +
        any_prog*any_type5 + any_prog*any_type6 +
        enep + disprop * pr + plurality * closeness + growth + lnincome,
    data = data_to_fit, effect = "twoways", model = "within"
)
ses <- lapply(fitted_models, vcovBK, cluster = "group")
pvals <- lapply(fitted_models,
    function(x) coeftest(x, vcov=function(m) vcovBK(m, cluster = "group"))[, 4]
)
# texreg( commented b/c persistent scaling trouble
#     fitted_models,
#     file = file.path(path_project, "artcl", "exploratory_models.tex"),
#     digits = 2,
#     override.se = lapply(ses, function(x){sqrt(diag(x))}),
#     override.p = pvals,
#     custom.coef.names = c("PEC Vote", "Parties", "Disproportionality",
#         "PR", "Plurality", "Closeness", "Economic Growth", "log(Income)",
#         "Disproportionality $\\times$ PR",  "Plurality $\\times$ Closeness",
#         "Nomination Agreement", "Joint List", "Vote Transfer Instructions",
#         "Public Commitment", "Other",
#         "Any incumbent?",
#         "Any incumbent? $\\times$ Nomination Agreement",
#         "Any incumbent? $\\times$ Joint List",
#         "Any incumbent? $\\times$ Vote Transfer Instructions",
#         "Any incumbent? $\\times$ Public Commitment",
#         "Any incumbent? $\\times$ Other",
#         "Any program?",
#         "Any program? $\\times$ Nomination Agreement",
#         "Any program? $\\times$ Joint List",
#         "Any program? $\\times$ Vote Transfer Instructions",
#         "Any program? $\\times$ Public Commitment",
#         "Any program? $\\times$ Other"
#     ),
#     # reorder.coef = c(1, 11, 2:10, 12, 14, 13),
#     booktabs = TRUE, sideways = TRUE,
#     stars = c(0.001,  0.01, 0.05, 0.1),
#     caption = "Exploratory Results",
#     label = "tbl:ExploratoryResults",
#     custom.note = paste0("Panel corrected SEs in parantheses ",
#         "\\cite{Beck.1995}, clustered by country. %stars."
#     )
# )
# tmp <- readLines(file.path(path_project, "artcl", "exploratory_models.tex"))
# tmp <- tmp[!(tmp == "")]  # drop empty strings
# tmp <- tmp[!grepl("\\usepackage", tmp)]  # drop usepackage entries
# tmp[5] <- paste(
#     "", "\\multicolumn{1}{c}{I}",
#     "\\multicolumn{2}{c}{II}",
#     "\\multicolumn{2}{c}{III}",
#     "\\multicolumn{2}{c}{IV}",
#     "\\multicolumn{2}{c}{V}",
#     "\\multicolumn{2}{c}{VI} \\\\",
#     sep = " & "
# )  # replace table header
# writeLines(tmp, con = file.path(path_project, "artcl", "exploratory_models.tex"))

nrep <- 1e4
pdta <- data.frame(
    mu = 0, lower90 = 0, lower95 = 0, upper90 = 0, upper95 = 0, condition = "",
    model = "", coef = "" )[0, ]
for (s in c("type", "type_vote")) {
    m <- fitted_models[[s]]
    base_terms <- grepl("^any_type[1-6]$", names(coef(m)))
    beta_sim <- MASS::mvrnorm(nrep, coef(m), Sigma = vcov(m))
    base_cis <- apply(beta_sim[, base_terms], 2, quantile, prob = c(.025, .05, .95, .975))
    mu_base <- apply(beta_sim[, base_terms], 2, mean)
    out <- data.frame(mu = mu_base, t(base_cis), condition = 0, model = s,
        coef = colnames(base_cis), stringsAsFactors = FALSE
    )
    names(out)[grep("X", names(out))] <- c(
        paste0("lower", c(95, 90)), paste0("upper", c(90, 95))
    )
    pdta <- rbind.data.frame(pdta, out)
}
for (s in c("incumbentXtype", "incumbentXtype_vote", "progXtype", "progXtype_vote")) {
    m <- fitted_models[[s]]
    base_terms <- grepl("^any_type[1-6]$", names(coef(m)))
    inter_terms <- grepl(":any_type[1-6]$", names(coef(m)))
    beta_sim <- MASS::mvrnorm(nrep, coef(m), Sigma = vcov(m))
    beta_inter <- beta_sim[, base_terms] + beta_sim[, inter_terms]
    base_cis <- apply(beta_sim[, base_terms], 2, quantile, prob = c(.025, .05, .95, .975))
    mu_base <- apply(beta_sim[, base_terms], 2, mean)
    out <- data.frame(mu = mu_base, t(base_cis), condition = 0, model = s,
        coef = colnames(base_cis), stringsAsFactors = FALSE
    )
    inter_cis <- apply(beta_inter, 2, quantile, prob = c(.025, .05, .95, .975))
    mu_inter <- apply(beta_inter, 2, mean)
    out <- rbind.data.frame(
        out,
        data.frame(mu = mu_inter, t(inter_cis), condition = 1, model = s,
            coef = colnames(base_cis),
            stringsAsFactors = FALSE
        )
    )
    names(out)[grep("X", names(out))] <- c(
        paste0("lower", c(95, 90)), paste0("upper", c(90, 95))
    )
    pdta <- rbind.data.frame(pdta, out)
}
pdta[, "col"] <- as.numeric(grepl("vote", pdta$model))
pdta[, "row"] <- ifelse(
    grepl("^type", pdta$model), 0, ifelse(grepl("^incumbent", pdta$model), 1, 2)
)
pdta <- within(pdta, {
    coef_label <- factor(coef, levels = c(
            "any_type5", "any_type1", "any_type2", "any_type3", "any_type4",
            "any_type6"
        ),
        labels = c("Public\nCommitment", "Nomination\nAgreement", "Joint\nList",
            "Dual-ballot\nInstructions", "Vote Transfer\nInstructions",
            "Other")
    )
    row_label <- factor(row, 0:2,
        labels = c("Marginal", "Any incumbent?", "Any joint program?")
    )
    col_label <- factor(col, 0:1,
        labels = c("Vote PEC not included", "Vote PEC included")
    )
    condition_label <- factor(condition, 0:1, c("No", "Yes"))
    }
)
shift <- position_dodge(width = .3)
ggplot(subset(pdta, col == 1), aes(x = coef_label, y = mu, fill = condition_label)) +
    geom_linerange(aes(ymin = lower95, ymax = upper95), position = shift) +
    geom_linerange(aes(ymin = lower90, ymax = upper90), size = 1.1, position = shift) +
    geom_point(shape = 21, position = shift, size = 2) +
    scale_fill_brewer(type = "seq", palette = 6) +
    scale_x_discrete(drop = FALSE) +
    scale_y_continuous(breaks = seq(5, -20, -5)) +
    labs(y = "Marginal Effect of PEC Type on Turnout",
         caption="Note: CIs at the 90 and 95 levels added. Figures summarize 10,000 simulated draws (see King et al. 2000)."
    ) +
    facet_grid(row_label ~ col_label) +
    ggthemes::theme_fivethirtyeight() +
    theme(
        axis.title = element_text(),
        axis.title.x = element_blank(),
        legend.title = element_blank()
    )
# housekeeping
for (p in packages) detach(paste("package", p, sep = ":"), character.only = TRUE)
rm(list = ls()[!(ls() %in% clean_workspace)])
```

The coefficient plots in Figure \ref{fig:exploratoryResults} summarize key
insights from our exploratory analysis.\footnote{
    Further detail is available from Table
    \ref{tbl:ExploratoryResults} in the appendix. We ran into
    trouble when simulating the confidence intervals from
    the panel-corrected variance-covariance matrix of the
    regressors. Any advice is welcome.
}
The graph follows the example of Figure \ref{fig:boxplotTurnoutAndOurPecsInTillman}
above. The top row shows the marginal effect of PEC type on turnout, the
middling row conditions this relationship on the presence of an incumbent PEC,
and the bottom does the same thing for the case that at least one PEC agrees on
a joint program. All three models reported in the graph include the total vote
share of PECs as a predictor. In light of what has been said so far, the
results are unsurprising.

\begin{enumerate}
    \item The top-left plot lends scant evidence to
        the presumption that PECs incentivize turnout in
        national elections. All coefficients but two are
        indistinguishable from $0$ at conventional levels of
        statistical significance. Vote transfer instructions
        and public commitments constitute the exceptions
        to the rule. Given that there are only $11$
        observations in the former group, this test of
        hypothesis is grossly underpowered and, hence,
        untrustworthy. The latter does not meet our
        expectations, which build on the premise that PEC of
        any type should increase turnout over the committed
        category: no PEC at all. Public announcements,
        however, seem to reduce turnout. Regardless, the
        overall pattern repeats in the two remaining panels.
        Moreover, the fact that the magnitudes of the
        estimated coefficients the results do not
        unequivocally differ across the types of PEC casts
        doubt on the idea that types reflect different levels of
        commitment. Under the bottom, we are lead to reject
        the presumption that the formation of PECs -- of any
        type -- influences turnout in national elections.
    \item Turning to potential interactive relationships in the
        data we have to confront yet another null result. As
        was foreshadowed by Figure
        \ref{fig:boxplotTurnoutAndOurPecsInTillman},
        coefficient estimates across the second and third
        row stay close to each other most of the time and all
        confidence intervals securely overlap. Whenever
        noteworthy differences do arise, as in the case of
        nomination agreements in the presence of at least
        one joint program, they go hand in hand with very
        large standard errors. The occasionally very slim
        empirical support for certain combinations of PEC
        properties are the probable reason. The consequence
        is well known, leading us to conclude that there are
        no  striking interactive relationships in the data.
    \item Finally, turning to the matter of common causes,
        the data once more reject our exploratory ideas. The
        intuition stated above was that types of PECs reflect
        different levels of commitment. Those differences in
        turn act as a common cause of turnout and the total
        vote share going to pre-electoral coalitions. If
        supported by the data, the estimated coefficient on
        Vote PEC should notably decrease or even turn
        statistically insignificant once PEC type or any of the
        stated interactions enter the model. As can be seen
        from the top row of Table
        \ref{tbl:ExploratoryResults} in the appendix, the
        opposite is the case. Vote PEC is positive and
        statistically significant across the entire range of
        statistical models discussed here. In other words, the
        seemingly robust association between PEC voting
        strength and turnout in national election is in fact
        remarkably robust. The question remains though:
        Why?
\end{enumerate}

The preceding exploratory analysis of PEC properties was motivated by a robust,
but theoretically shallow association between PEC vote share and turnout.
If pre-electoral coalitions signal viable post-election governments to voters
in multiparty systems, then it stands to reason that both turnout and PEC vote
relate to the strength of this signal. More precisely, we presume that this signal
becomes more powerful the more committed parties are to their PEC. Starting
from this theoretical intuition, we argue that the properties of pre-electoral
coalitions such as their type, incumbent status, and the existence of a joint
program, reflect varying levels of commitment and should confound the
association between PEC vote share and turnout. The data forcefully reject our
theoretical intuition. Neither is there reason to believe that PEC types
interfere with turnout in any form nor do they act as a common cause of the
motivating, empirical relationship. The question is why and will subject to
future research.

\section{Washing List: The Better Conclusion}

I will provide points for discussion during the presentation.
\newpage

\bibliographystyle{plain}
\bibliography{library}

\newpage

\section{Appendix}

\subsection{Country-level trends}

```{r, edaCommonTrend, fig.cap="Country-Specific Trends in the Data", fig.pos="h"}
rm(list = ls()[!(ls() %in% clean_workspace)])
max_degree = 3
pdta <- select(tillman, country, year, turnout, pec1, vote_pec) %>%
    group_by(country) %>%
    mutate_at(vars(turnout, pec1, vote_pec), scale) %>%
    ungroup() %>%
    mutate(country = ifelse(country == "NewZealand", "New Zealand", country)) %>%
    gather("key", "value", turnout, pec1, vote_pec) %>%
    mutate(key = factor(as.character(key),
            levels = c("turnout", "pec1", "vote_pec"),
            labels = c("Turnout", "PEC contested", "PEC result")
        )
    )
ggplot(data = pdta, aes(x = year, y = value, linetype = key)) +
    geom_smooth(
        method = "lm", formula = y ~ poly(x, max_degree), se = FALSE, colour = "black", size = .7
    ) +
    geom_rug(sides = "b") +
    ggthemes::theme_fivethirtyeight(base_size = base_size * .75) +
    facet_wrap(~ country) +
    labs(
        y = "Scaled Within-Differences", linetype = "",
        caption = "Note: Figures scaled by within-country std. dev. Cubic polynomials shown. Rugs indicate elections."
    ) +
    theme(
        axis.title = element_text(),
        axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1),
        axis.title.x = element_blank(),
        legend.position = "bottom"
    )
```
\newpage

\subsection{Detailed Replications Results}

\include{detrended_models}
\newpage

\subsection{Detailed exploratory results}

\include{exploratory_models}
\newpage

## Detailed Coverage of our PEC Data

```{r, pecsSummaryTable, results = "asis"}
# EDA: Return basic data information table
rm(list = ls()[!(ls() %in% clean_workspace)])
packs <- c("lubridate", "stargazer")
missing <- which(!(packs %in% rownames(installed.packages())))
if (any(missing)) {
    cat("Installing missing packages: ", packs[missing], "\n")
    install.packages(packs[missing], dependencies = TRUE)
}
for (p in packs) library(p, character.only = TRUE, quietly = TRUE)

# Constants
col_names <- c("Country", "First election", "Last election",
    "# Elections", "# PECs", "Min", "Med", "Max"
)


# Data objects
tmp <- as_tibble(filter(country_panel, in_lsvergl == 1)) %>%
    mutate(edate = ymd(election_date)) %>%
    group_by(iso3c)
first_election <- summarize_at(tmp, vars(edate), min) %>%
    rename("first_election" = edate)
last_election <- summarize_at(tmp, vars(edate), max) %>%
    rename("last_election" = edate)
n_elections <- summarize_at(tmp, vars(edate), function(x) length(unique(x))) %>%
    rename("n_elections" = edate)
n_pecs <- summarize_at(tmp, vars(nupec_neu), sum) %>%
    rename("n_pecs" = nupec_neu)
range_n_pecs <- summarize_at(tmp, vars(nupec_neu),
    .funs = list(min = min, median = median, max = max)
)
tmp <- plyr::join_all(
    list(first_election, last_election, n_elections, n_pecs, range_n_pecs),
    by = "iso3c", type = "inner"
)
tmp <- tmp[with(tmp, order(n_pecs)), ]
names(tmp) <- col_names


# Return table
stargazer(
    tmp,
    title = "Summary of pre-electoral coalitions and elections by country",
    label = "tbl:summaryPecs",
    summary = FALSE, style = "apsr", header = FALSE, rownames = FALSE
)


# housekeeping
for (p in packs) detach(paste("package", p, sep = ":"), character.only = TRUE)
rm(list = ls()[!(ls() %in% clean_workspace)])
```

```{r, edaPecOverTime, fig.cap="Distribution of PECs over Time"}
rm(list = ls()[!(ls() %in% clean_workspace)])


# Prep plot data
nupec_per_year <- aggregate( # How many PECs per year?
    nupec_neu ~ year,
    data = subset(country_panel, in_lsvergl == 1), FUN = sum
)
nelec_per_year <- aggregate(  # How many elections per year?
    election_id ~ year, data = subset(country_panel, in_lsvergl == 1),
    FUN = function(x) length(x)
)
perc_pec_per_year <- filter(country_panel, in_lsvergl == 1) %>%
    # relative freq of PECs in elections per year
    select(year, nupec_neu) %>%
    mutate(pec = ifelse(nupec_neu > 0, 1, 0)) %>%
    group_by(year) %>%
    summarise_at(vars(pec), mean)
pdta <- plyr::join_all(list(nupec_per_year, nelec_per_year, perc_pec_per_year),
    by = "year", type = "inner"
)
pdta <- gather(pdta, "key", "value", nupec_neu, election_id, pec)
pdta <- within(pdta,
    key_labels <- factor(as.character(key),
        levels = c("nupec_neu", "election_id", "pec"),
        labels = c("No. of PECs", "No. of elections",
            "Share elections with PECs"
        )
    )
)


# Return plot
ggplot(data = pdta, aes(x = year, y = value)) +
    geom_bar(stat = "identity", width = .9) +
    facet_grid(key_labels ~ ., scales = "free_y") +
    scale_x_continuous(breaks = seq(1945, 2015, 10)) +
    labs(y = "Frequency") +
    theme(axis.title.x = element_blank())

# housekeeping
rm(list = ls()[!(ls() %in% clean_workspace)])
```

\begin{table}[htb]
    \centering
    \begin{tabular}{llccc}
    \toprule
    Attribute & Value & Freq. & Cum. Freq. & Cum. Rel. Freq.\\
    \midrule
    Type & Nomination agreement & 72 & 72 & 0.14\\
        ~ & Joint list & 204 & 276 & 0.63\\
        ~ & Dual-ballot instructions & 1 & 277 & 0.64\\
        ~ & Vote transfer instructions & 24 & 301 & 0.69\\
        ~ & Public commitment & 119 & 420 & 0.96\\
        ~ & Other & 16 & 436 & 1.00\\
    \midrule
    Joint program & No & 233 & 233 & 0.54\\
        ~ & Yes & 197 & 430 & 1.00\\
    \midrule
    Incumbent coalition & No & 337 & 337 & 0.77\\
        ~ & Yes & 99 & 436 & 1.00\\
    \bottomrule
    \end{tabular}
    \caption{Summary of pre-electoral coalition properties, 1945-2015}
    \label{tbl:SummaryPecProperties}
\end{table}

```{r, tablePecsByType, eval = FALSE}
# This snippet returns the data required to reproduce table "XXX"
rm(list = ls()[!(ls() %in% clean_workspace)])

# functions
flag_nas <- function(r) all(is.na(r))

# data objects
pecs <- read_dta(
    file.path(path_project, "dta", "raw", "PEC_raw_stable15_2.dta"),
    encoding = "latin1"
)

# constants
pec_indicators <- grep("^[pec1-9]{4}$", names(pecs), perl = TRUE, value = TRUE)
suffixes <- c("type", "prog", "incumbent", "ea")
pec_indicators_2_aggregate <- character(0)
for (suffix in suffixes) {
    pec_indicators_2_aggregate <- append(
        pec_indicators_2_aggregate, paste(pec_indicators, suffix, sep = "_")
    )
}

# filter data
# (a) remove parties that did not enter PECs
pecs[, "no_pecs"] <- apply(pecs[, pec_indicators], 1, flag_nas)
pecs <- filter(pecs, !no_pecs)
# (b) aggregate to single pec entry per election
tmp <- subset(pecs, select = c("election_id", pec_indicators_2_aggregate))
tmp <- aggregate(
    x = as.data.frame(tmp[, -1]),
    by = list(election_id = tmp[["election_id"]]),
    FUN = function(x) ifelse(all(is.na(x)), NA, max(x, na.rm = TRUE))
)
# sanity check: n type codings <= nupec_neu
sum(!is.na(tmp[, paste(pec_indicators, "type", sep="_")])) <=
    sum(country_panel$nupec_neu, na.rm = TRUE)
# sanity check: n is.na(type) + n !(is.na(type)) == nupec_neu
sum(apply(tmp[, paste(pec_indicators, "type", sep="_")], 1, flag_nas)) +
    sum(!is.na(tmp[, paste(pec_indicators, "type", sep="_")])) ==
    sum(country_panel$nupec_neu, na.rm = TRUE)
# FAILS! 29 all NA entries, should be 12
tmp[apply(tmp[, paste(pec_indicators, "type", sep="_")], 1, flag_nas), 1]
# Elections in question: 20 166 171 205 227 284 291 306 357 386 403 407 453 479
# 496 508 596 606 623 643 653 664 709 710 711 712 713 715 782

# sanity checks: n codings <= sum of nupec_neu?
sum(!is.na(tmp[, paste(pec_indicators, "incumbent", sep="_")]))
sum(!is.na(tmp[, paste(pec_indicators, "prog", sep="_")]))
sum(!is.na(tmp[, paste(pec_indicators, "ea", sep="_")]))
# All pass

# sanity checks: n is.na(suffixes) + n !(is.na(suffixes)) == nupec_neu
sum(apply(tmp[, paste(pec_indicators, "incumbent", sep="_")], 1, flag_nas)) +
    sum(!is.na(tmp[, paste(pec_indicators, "incumbent", sep="_")])) # fails
sum(apply(tmp[, paste(pec_indicators, "prog", sep="_")], 1, flag_nas)) +
    sum(!is.na(tmp[, paste(pec_indicators, "prog", sep="_")])) # fails
sum(apply(tmp[, paste(pec_indicators, "ea", sep="_")], 1, flag_nas)) +
    sum(!is.na(tmp[, paste(pec_indicators, "ea", sep="_")])) # fails
# This test fails every time. Something about the test must be wrong

# create table
for (suffix in suffixes) {
    selection <- paste(pec_indicators, suffix, sep = "_")
    assign(suffix, gather(tmp[, selection], "pec", "value", selection)[[2]])
    # names(suffix, character.only = TRUE)
}
type <- factor(type, seq(6), c("Nomination agreement", "Joint list",
    "Dual-ballot instructions", "Vote transfer instructions", "Public commitment",
    "other"
    )
)
for (i in suffixes[-1]){
    assign(i, factor(get(i), 0:1, c("No", "Yes")))
}
lapply(mget(suffixes), function(x) cumsum(table(x)) / sum(table(x)))

# housekeeping
rm(list = ls()[!(ls() %in% clean_workspace)])
```
